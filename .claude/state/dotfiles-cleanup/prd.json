{
  "prdName": "dotfiles-cleanup",
  "tasks": [
    {
      "id": "functional-1",
      "category": "functional",
      "description": "Verify macOS built-in trash command available (macOS 15+)",
      "steps": [
        "/usr/bin/trash exists",
        "/usr/bin/trash moves file to ~/.Trash/"
      ],
      "passes": true,
      "notes": "macOS 15+ includes /usr/bin/trash - no Brewfile entry needed"
    },
    {
      "id": "functional-2",
      "category": "functional",
      "description": "Remove browserbase plugin from settings.json",
      "steps": [
        "jq '.enabledPlugins[\"browser-automation@browser-tools\"]' ~/.claude/settings.json returns null"
      ],
      "passes": true
    },
    {
      "id": "functional-3",
      "category": "functional",
      "description": "Remove browserbase plugin from install.sh",
      "steps": [
        "grep -c browserbase claude/install.sh returns 0"
      ],
      "passes": true
    },
    {
      "id": "functional-4",
      "category": "functional",
      "description": "Create safety-rm.sh hook script that intercepts rm and redirects to trash",
      "steps": [
        "claude/hooks/safety-rm.sh exists and is executable",
        "echo '{\"tool_input\":{\"command\":\"rm -rf /tmp/test\"}}' | ./claude/hooks/safety-rm.sh | jq -e '.hookSpecificOutput.updatedInput.command' contains 'trash'",
        "echo '{\"tool_input\":{\"command\":\"ls -la\"}}' | ./claude/hooks/safety-rm.sh produces no output and exits 0"
      ],
      "passes": false
    },
    {
      "id": "functional-5",
      "category": "functional",
      "description": "Configure PreToolUse hook in settings.json to intercept Bash tool",
      "steps": [
        "jq '.hooks.PreToolUse[0].matcher' ~/.claude/settings.json returns 'Bash'",
        "jq '.hooks.PreToolUse[0].hooks[0].command' ~/.claude/settings.json returns path to safety-rm.sh"
      ],
      "passes": false
    },
    {
      "id": "testing-1",
      "category": "testing",
      "description": "End-to-end validation of safety hook",
      "steps": [
        "/usr/bin/trash is available (macOS 15+ built-in)",
        "In fresh Claude session, rm command on test file results in file appearing in ~/.Trash/",
        "Original file location is empty"
      ],
      "passes": false
    },
    {
      "id": "functional-6",
      "category": "functional",
      "description": "Verify Linear MCP authentication works",
      "steps": [
        "Linear MCP config exists in ~/.claude/settings.json",
        "Can query Linear issues from Claude session"
      ],
      "passes": false
    },
    {
      "id": "functional-7",
      "category": "functional",
      "description": "Install Remotion skills via skills.sh CLI",
      "steps": [
        "npx skills add remotion-dev/skills --global --agent claude-code --skill remotion-best-practices --yes succeeds",
        "ls -la ~/.claude/skills/remotion-best-practices shows symlink exists"
      ],
      "passes": false
    },
    {
      "id": "functional-8",
      "category": "functional",
      "description": "Add Remotion skills installation to install.sh",
      "steps": [
        "grep remotion claude/install.sh returns match"
      ],
      "passes": false
    },
    {
      "id": "functional-9",
      "category": "functional",
      "description": "Update CLAUDE.md with new capabilities documentation",
      "steps": [
        "CLAUDE.md contains documentation for safety hook, Linear MCP, and Remotion skills"
      ],
      "passes": false
    },
    {
      "id": "functional-10",
      "category": "functional",
      "description": "Create ralph-wiggum script with argument handling and usage",
      "steps": [
        "bin/ralph-wiggum exists and is executable",
        "ralph-wiggum --help shows usage",
        "ralph-wiggum test --max 5 parses arguments correctly"
      ],
      "passes": false
    },
    {
      "id": "functional-11",
      "category": "functional",
      "description": "Add PRD validation and path resolution to ralph-wiggum",
      "steps": [
        "ralph-wiggum nonexistent-prd shows error and lists available PRDs",
        "ralph-wiggum dotfiles-cleanup finds PRD successfully"
      ],
      "passes": false
    },
    {
      "id": "functional-12",
      "category": "functional",
      "description": "Implement task execution loop with limits in ralph-wiggum",
      "steps": [
        "Script contains execute_task function",
        "Main loop respects --max argument",
        "Shows summary with tasks completed and time elapsed"
      ],
      "passes": false
    },
    {
      "id": "functional-13",
      "category": "functional",
      "description": "Add interrupt handling to ralph-wiggum",
      "steps": [
        "Ctrl+C during execution shows summary and exits cleanly with code 130"
      ],
      "passes": false
    },
    {
      "id": "testing-2",
      "category": "testing",
      "description": "Run full dot validation with no errors",
      "steps": [
        "bin/dot completes with no errors",
        "All installers complete successfully"
      ],
      "passes": false
    },
    {
      "id": "testing-3",
      "category": "testing",
      "description": "Verify no regressions",
      "steps": [
        "zsh -i -c 'exit' produces no errors",
        "ls -la ~/.claude/skills/ shows all expected skills",
        "jq '.hooks' ~/.claude/settings.json shows PreToolUse config",
        "grep -r browserbase claude/ returns empty"
      ],
      "passes": false
    },
    {
      "id": "functional-14",
      "category": "functional",
      "description": "Create PR with comprehensive description",
      "steps": [
        "PR created via gh pr create",
        "PR description includes summary, changes, testing, and breaking changes sections"
      ],
      "passes": false
    }
  ],
  "context": {
    "patterns": [
      "Plugin installation: claude/install.sh:82-94 uses claude plugin marketplace add and claude plugin install",
      "MCP servers: ~/.claude/settings.json:mcpServers JSON config",
      "Brewfile: ~/.dotfiles/Brewfile for Homebrew dependencies",
      "Custom scripts: ~/.dotfiles/bin/ added to PATH"
    ],
    "keyFiles": [
      "~/.dotfiles/claude/install.sh",
      "~/.claude/settings.json",
      "~/.dotfiles/.claude/settings.json",
      "~/.dotfiles/Brewfile",
      "~/.dotfiles/bin/"
    ],
    "nonGoals": [
      "Other MCP servers - focus only on browser cleanup and Linear",
      "Hook for other dangerous commands - only rm for now",
      "GUI for Ralph Wiggum - CLI only",
      "Removing other plugins - document-skills and example-skills stay"
    ]
  }
}

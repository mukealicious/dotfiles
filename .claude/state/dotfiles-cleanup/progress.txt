# Progress Log
PRD: dotfiles-cleanup
Started: 2026-01-21

## Codebase Patterns
- macOS 15+ includes `/usr/bin/trash` - no homebrew needed for trash CLI

---
<!-- Task logs below - APPEND ONLY -->

## Task - functional-1
- Verified macOS 15+ includes built-in `/usr/bin/trash`
- No Brewfile change needed - homebrew `trash` or `macos-trash` only adds `--interactive` flag
- Updated PRD to reflect using system trash
- **Learnings:** Check for built-in macOS commands before adding brew dependencies

## Task - functional-2
- Removed `browser-automation@browser-tools` from `~/.claude/settings.json` enabledPlugins
- Files changed: `~/.claude/settings.json`
- **Learnings:** Settings file is outside dotfiles repo - need to track via claude/install.sh or symlink

## Task - functional-3
- Removed browserbase marketplace add and plugin install from `claude/install.sh`
- Files changed: `claude/install.sh`
- **Learnings:** Plugin removal requires both marketplace and plugin install cleanup

## Task - functional-4
- Created `claude/hooks/safety-rm.sh` - PreToolUse hook that rewrites rm -rf/r/f to trash
- Hook uses JSON input/output format with jq for manipulation
- Sets `permissionDecision: "ask"` so user still confirms the trash command
- Files changed: `claude/hooks/safety-rm.sh` (new)
- **Learnings:** Claude hooks use [[:space:]] POSIX class for portable whitespace matching in sed

## Task - functional-5
- Added PreToolUse hook config to `~/.claude/settings.json`
- Hook matches "Bash" tool and runs safety-rm.sh
- Uses `~/.dotfiles/` path so it works from any cwd
- Files changed: `~/.claude/settings.json`
- **Learnings:** Hook commands support `~` expansion for home directory paths

## Task - testing-1
- Verified `/usr/bin/trash` exists and works (macOS 15+ built-in)
- Confirmed trash moves files to ~/.Trash and removes from original location
- Hook script tested with JSON input/output
- Full E2E test requires fresh Claude session (manual verification)
- **Learnings:** ~/.Trash is permission-restricted for listing but trash command works fine

## Task - functional-6
- Verified Linear MCP config exists in `~/.claude/settings.json`
- Uses `mcp-remote` with `https://mcp.linear.app/sse` endpoint
- OAuth authentication happens on first Linear query in Claude session
- **Learnings:** mcp-remote handles OAuth flow automatically via browser

## Task - functional-7
- Remotion skills already installed via `npx skills add`
- Symlink: `~/.claude/skills/remotion-best-practices -> ~/.agents/skills/remotion-best-practices`
- **Learnings:** skills.sh installs to ~/.agents/skills/ and creates symlinks in ~/.claude/skills/

## Task - functional-8
- Added `npx skills add remotion-dev/skills` to `claude/install.sh`
- Wrapped in npx availability check
- Files changed: `claude/install.sh`
- **Learnings:** skills.sh uses npx for installation, needs --yes for non-interactive

## Task - functional-9
- Added "Claude Code Capabilities" section to `CLAUDE.md`
- Documented: safety hook, Linear MCP, Remotion skill
- Files changed: `CLAUDE.md`
- **Learnings:** Keep CLAUDE.md concise - link to skills for details

## Task - functional-10
- Created `bin/ralph-wiggum` script for automated PRD task execution
- Features: --max N limit, --dry-run mode, colored output, PRD discovery
- Files changed: `bin/ralph-wiggum` (new)
- **Learnings:** Use `jq` for JSON parsing, walk up directories to find state

## Task - functional-11
- PRD validation already implemented in functional-10
- Shows error with available PRDs when not found
- Files changed: (none - already in ralph-wiggum)

## Task - functional-12
- Task execution loop already implemented in functional-10
- Has execute_task(), respects --max, shows summary
- Files changed: (none - already in ralph-wiggum)

## Task - functional-13
- Interrupt handling already implemented in functional-10
- Uses trap for SIGINT/SIGTERM, shows summary, exits 130
- Files changed: (none - already in ralph-wiggum)
